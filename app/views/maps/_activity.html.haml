%div#map_activity.mt_20.mb_20.pt_10
  %div.bold.flex_center{:style => 'margin: 12px;'}
    %span.sorted_submissions
      - if pagy.count == 0
        No recent edits within the map view
      - else
        Showing #{pagy.from}-#{pagy.to} of #{pagy.count}#{pagy.count >= 2000 ? '+' : ''} recent edits within the map view
    %span.close_activity.pointer{:onclick => "closeActivity();"}
      X

  %details.activity_filter_dropdown
    %summary
      - active_filters = submission_types.is_a?(Array) ? submission_types : [submission_types]
      - filter_labels = { 'new_lmx' => 'Machine added', 'remove_machine' => 'Machine removed', 'new_condition' => 'Condition report', 'confirm_location' => 'Location confirmed' }
      - active_labels = active_filters.map { |f| filter_labels[f] }.compact
      - if active_labels.size < 4
        Showing only #{active_labels.join(', ')}
      - else
        Filter activity updates
    = form_tag user_submissions_list_within_range_path, :method => 'post', id: 'activity_filter' do
      %label.activity_filter_option
        =image_tag("icons/new_lmx.svg", :alt => "new_lmx", :class => 'filter_icon')
        %input{:type => "checkbox", :name => "submission_type[]", :value => 'new_lmx', :checked => submission_types.include?('new_lmx')}
        %span Machine added
      %label.activity_filter_option
        =image_tag("icons/remove_machine.svg", :alt => "remove_machine", :class => 'filter_icon')
        %input{:type => "checkbox", :name => "submission_type[]", :value => 'remove_machine', :checked => submission_types.include?('remove_machine')}
        %span Machine removed
      %label.activity_filter_option
        =image_tag("icons/new_condition.svg", :alt => "new_condition", :class => 'filter_icon')
        %input{:type => "checkbox", :name => "submission_type[]", :value => 'new_condition', :checked => submission_types.include?('new_condition')}
        %span Condition report
      %label.activity_filter_option
        =image_tag("icons/confirm_location.svg", :alt => "confirm_location", :class => 'filter_icon')
        %input{:type => "checkbox", :name => "submission_type[]", :value => 'confirm_location', :checked => submission_types.include?('confirm_location')}
        %span Location confirmed
      .flex_center
        = submit_tag 'Apply filters', :class => "save_button", :style => "margin-top: 12px; text-transform: none; padding-left: 40px; padding-right: 40px;"

  - sorted_submissions.each do |recent_activity|
    = render 'shared/activity_item', activity: recent_activity, show_location_link: true

  - if pagy.pages > 1
    #next_link{:style => 'margin: 20px 10px; padding-bottom: 20px;'}
      != pagy_nav(pagy)

:javascript
  $(document).trigger('activity-loaded');
